<?xml version="1.0" encoding="utf-8"?>
<templates>
  <t t-name="meeting_management_base.MeetingSessionView">
    <div class="dw-meeting-view" role="main">
      <!-- Header -->
      <header class="meeting-header">
        <div class="meeting-header-left">
          <button class="btn-back" t-on-click="goBack" title="Back">
            <i class="fa fa-arrow-left"/>
          </button>
          <div class="meeting-title-section">
            <h1 class="meeting-title">
              <t t-esc="state.session.name"/>
            </h1>
            <div class="meeting-meta-info">
              <span class="meta-badge">
                <i class="fa fa-clock-o"/>
                <t t-esc="state.session.actual_start_datetime"/>
              </span>
              <span class="meta-badge">
                <i class="fa fa-hourglass-half"/>
                <t t-esc="state.session.duration"/>h
              </span>
              <span class="meta-badge" t-if="state.session.is_host">
                <i class="fa fa-star"/>
                Host
              </span>
            </div>
          </div>
        </div>
        <div class="meeting-header-right">
          <span class="status-chip" t-att-class="state.session.state">
            <span class="status-dot"/>
            <t t-esc="state.session.state.charAt(0).toUpperCase() + state.session.state.slice(1).replace('_', ' ')"/>
          </span>
          <button class="btn-action primary" t-on-click="toggleNotes" title="Notes" t-if="state.session.display_camera">
            <i class="fa fa-pencil"/>
          </button>
          <button class="btn-action primary" t-on-click="toggleActions" title="Actions" t-if="state.session.display_camera">
            <i class="fa fa-tasks"/>
          </button>
          <button class="btn-action danger" t-on-click="leaveMeeting" title="Leave">
            <i class="fa fa-sign-out"/>
          </button>
          <button class="btn-action danger" t-if="state.session.is_host" t-on-click="endMeeting" title="End Meeting for All">
            <i class="fa fa-power-off"/>
          </button>
            <button class="btn-action primary" t-on-click="toggleCamera" title="Toggle Camera">
            <i t-att-class="state.session.display_camera ? 'fa fa-eye-slash' : 'fa fa-eye'"/>
        </button>
        </div>
      </header>

      <!-- Content Grid -->
      <div class="meeting-content-grid">
        <!-- Left Sidebar: Participants -->
        <aside class="meeting-sidebar">
          <div class="sidebar-card">
            <div class="card-header">
              <h3>
                <i class="fa fa-users"/>
                Participants (<t t-esc="state.session.participants?.length"/>)
              </h3>
            </div>
            <div class="card-body">
              <div class="participants-list">
                <t t-if="state.session.participants?.length">
                  <t t-foreach="state.session.participants" t-as="p" t-key="p_index">
                    <div class="participant-item">
                      <div class="participant-avatar">
                        <t t-esc="p.name.slice(0, 2).toUpperCase()"/>
                      </div>
                      <div class="participant-info">
                        <div class="participant-name">
                          <t t-esc="p.name"/>
                        </div>
                      </div>
                    </div>
                  </t>
                </t>
                <t t-else="">
                  <div class="empty-participants">
                    <i class="fa fa-users"/>
                    <p>No participants</p>
                  </div>
                </t>
              </div>
            </div>
          </div>

          <!-- Waiting Participants (only for hosts) -->
          <div class="sidebar-card" t-if="state.session.is_host &amp;&amp; state.waitingParticipants.length">
            <div class="card-header">
              <h3>
                <i class="fa fa-hourglass"/>
                Waiting (<t t-esc="state.waitingParticipants.length"/>)
              </h3>
            </div>
            <div class="card-body">
              <div class="participants-list">
                <t t-foreach="state.waitingParticipants" t-as="w" t-key="w.id">
                  <div class="participant-item">
                    <div class="participant-avatar">
                      <t t-esc="w.name?.slice(0, 2).toUpperCase()"/>
                    </div>
                    <div class="participant-info">
                      <div class="participant-name">
                        <t t-esc="w.name"/>
                      </div>
                    </div>
                    <div style="display:flex; gap:4px;">
                      <button class="btn-icon-sm"
                              t-on-click="() => admitParticipant(w.id)"
                              title="Admit">
                        <i class="fa fa-check" style="color: #10b981;"/>
                      </button>
                      <button class="btn-icon-sm"
                              t-on-click="() => rejectParticipant(w.id)"
                              title="Reject">
                        <i class="fa fa-times" style="color: #ef4444;"/>
                      </button>
                    </div>
                  </div>
                </t>
              </div>
            </div>
          </div>

          <!-- Meeting Info -->
          <div class="sidebar-card">
            <div class="card-header">
              <h3>
                <i class="fa fa-info-circle"/>
                Details
              </h3>
            </div>
            <div class="card-body">
              <div class="info-list">
                <div class="info-item" t-if="state.session.objet">
                  <label>Subject</label>
                  <span t-esc="state.session.objet"/>
                </div>
                <div class="info-item" t-if="state.session.meeting_type_id">
                  <label>Type</label>
                  <span t-esc="state.meetingTypeName"/>
                </div>
                <div class="info-item">
                  <label>Duration</label>
                  <span>
                    <t t-esc="state.sessionDuration"/> hours
                  </span>
                </div>
                <div class="info-item">
                  <label>Elapsed Time</label>
                  <span t-esc="state.meetingDuration"/>
                </div>
                <div class="info-item" t-if="state.session.join_datetime">
                  <label>Joined At</label>
                  <span t-esc="state.formattedJoinTime"/>
                </div>
              </div>
            </div>
          </div>
        </aside>

          <!-- Main: Tabbed Content with Navigation -->
        <main class="meeting-main">
          <!-- Tab Navigation Bar -->
          <div class="main-tab-navigation">
            <button
              class="tab-nav-button"
              t-att-class="{ 'active': state.activeMainTab === 'video' }"
              t-on-click="() => this.state.activeMainTab = 'video'">
              <i class="fa fa-video-camera"/>
              <span>Video Conference</span>
            </button>
            <button
              class="tab-nav-button"
              t-att-class="{ 'active': state.activeMainTab === 'actions' }"
              t-on-click="() => this.state.activeMainTab = 'actions'">
              <i class="fa fa-tasks"/>
              <span>Actions (<t t-esc="state.actions.length"/>)</span>
            </button>
            <button
              class="tab-nav-button"
              t-att-class="{ 'active': state.activeMainTab === 'notes' }"
              t-on-click="() => this.state.activeMainTab = 'notes'">
              <i class="fa fa-file-text-o"/>
              <span>My Notes</span>
            </button>
            <button
                  class="tab-nav-button"
                  t-att-class="{ 'active': state.activeMainTab === 'agenda' }"
                  t-on-click="() => this.state.activeMainTab = 'agenda'">
                  <i class="fa fa-file-text-o"/>
                  <span>Agenda</span>
            </button>
              <button
                  class="tab-nav-button"
                  t-att-class="{ 'active': state.activeMainTab === 'pv' }"
                  t-on-click="() => this.state.activeMainTab = 'pv'">
                  <i class="fa fa-file-text-o"/>
                  <span>PV</span>
            </button>
          </div>

          <!-- Video Conference Section -->
          <div class="main-tab-content" t-if="state.activeMainTab === 'video'">
            <div class="video-conference-container">
              <div id="jitsi-meet-container" class="jitsi-container"/>

              <!-- Loading -->
              <div class="video-loading" t-if="state.loading &amp;&amp; !state.error">
                <div class="loading-spinner">
                  <div class="spinner-ring"/>
                </div>
                <p>Loading meeting session...</p>
              </div>

              <!-- Error -->
              <div class="video-error" t-if="state.error">
                <div class="error-icon">
                  <i class="fa fa-exclamation-triangle"/>
                </div>
                <h3>Connection Error</h3>
                <p t-esc="state.error"/>
                <div class="error-actions">
                  <button class="btn-retry" t-on-click="retryConnection">
                    <i class="fa fa-refresh"/>
                    Retry
                  </button>
                  <button class="btn-secondary" t-on-click="goBack">
                    <i class="fa fa-arrow-left"/>
                    Back
                  </button>
                </div>
              </div>

              <!-- Timer -->
              <div class="meeting-timer" t-if="state.jitsiLoaded">
                <i class="fa fa-circle recording-indicator"/>
                <span t-esc="state.meetingDuration"/>
              </div>
            </div>
          </div>

<!--            agenda section-->
            <div class="main-tab-content" t-if="state.activeMainTab === 'agenda'">
              <div class="meeting-actions-section">
                <div class="actions-header">
                  <h3>
                    <i class="fa fa-list"/>
                    Agenda Items
                  </h3>
                </div>
                <div class="agenda-body">
                  <t t-if="state.session.subject_order?.length">
                    <t t-foreach="state.session.subject_order" t-as="item" t-key="item.id">
                      <div class="agenda-item">
                        <div class="agenda-title">
                          <t t-esc="item.name"/>
                        </div>
                        <div class="agenda-description" t-if="item.description">
                          <t t-esc="item.description"/>
                        </div>
                      </div>
                    </t>
                  </t>
                  <t t-else="">
                    <div class="empty-agenda">
                      <p>No agenda items</p>
                    </div>
                  </t>
                </div>
              </div>
            </div>

          <!-- Actions Section -->
          <div class="main-tab-content" t-if="state.activeMainTab === 'actions'">
            <div class="meeting-actions-section">
              <div class="actions-header">
                <h3>
                  <i class="fa fa-tasks"/>
                  My Action Items (<t t-esc="state.actions.length"/>)
                </h3>
                <div class="actions-header-actions">
                  <button class="btn-add-action" t-on-click="addNewAction">
                    <i class="fa fa-plus"/>
                    Add Action
                  </button>
                </div>
              </div>
              <div class="actions-body">
                <div class="actions-list">
                  <t t-if="state.actions.length">
                    <t t-foreach="state.actions" t-as="action" t-key="action.id || action_index">
                      <div class="action-item" t-att-data-status="action.status">
                        <div class="action-item-header">
                          <input
                            type="text"
                            class="action-title-input"
                            t-model="action.name"
                            placeholder="Action title..."
                            t-on-change="() => updateAction(action)"/>
                          <button class="btn-delete-action" t-on-click="() => deleteAction(action)">
                            <i class="fa fa-trash"/>
                          </button>
                        </div>
                        <div class="action-item-body">
                          <div class="action-fields-grid">
                            <div class="action-field">
                              <label><i class="fa fa-user"/> Assigned to:</label>
                              <select t-model="action.assignee_id" t-on-change="() => updateAction(action)">
                                <option value="">Select assignee...</option>
                                <t t-foreach="state.availableAssignees" t-as="assignee" t-key="assignee.id">
                                  <option t-att-value="assignee.id">
                                    <t t-esc="assignee.name"/>
                                  </option>
                                </t>
                              </select>
                            </div>
                            <div class="action-field">
                              <label><i class="fa fa-calendar"/> Due Date:</label>
                              <input
                                type="date"
                                t-model="action.dead_line"
                                t-on-change="() => updateAction(action)"/>
                            </div>
                            <div class="action-field">
                              <label><i class="fa fa-flag"/> Priority:</label>
                              <select t-model="action.priority" t-on-change="() => updateAction(action)">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                              </select>
                            </div>
                            <div class="action-field">
                              <label><i class="fa fa-tasks"/> Status:</label>
                              <select t-model="action.status" t-on-change="() => updateAction(action)">
                                <option value="todo">To Do</option>
                                <option value="in_progress">In Progress</option>
                                <option value="done">Done</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                    </t>
                  </t>
                  <t t-else="">
                    <div class="empty-actions">
                      <i class="fa fa-tasks"/>
                      <p>No action items yet</p>
                      <button class="btn btn-primary btn-sm" t-on-click="addNewAction">
                        <i class="fa fa-plus"/>
                        Add First Action
                      </button>
                    </div>
                  </t>
                </div>
              </div>
            </div>
          </div>

          <!-- Notes Section -->
          <div class="main-tab-content" t-if="state.activeMainTab === 'notes'">
            <div class="meeting-notes-section">
              <div class="notes-header">
                <h3>
                  <i class="fa fa-file-text-o"/>
                  My Notes
                </h3>
                <div class="notes-actions">
                  <button class="btn-save-notes" t-on-click="saveNotes">
                    <i class="fa fa-save"/>
                    Save
                  </button>
                </div>
              </div>
              <div class="notes-editor">
                <textarea
                  class="notes-textarea"
                  placeholder="Type your personal notes here..."
                  t-model="state.notes"/>
              </div>
            </div>
          </div>

        <div class="main-tab-content" t-if="state.activeMainTab === 'pv'">
          <div class="meeting-notes-section">
            <div class="notes-header">
              <h3>
                <i class="fa fa-file-text-o"/>
                Procès-Verbal (PV)
              </h3>
              <div class="notes-actions">
                <!-- Template Selection Buttons -->
                <button class="btn-save-notes" t-on-click="startBlankPv" title="Start with blank PV">
                  <i class="fa fa-file-o"/>
                  <span>PV Personnalisé</span>
                </button>
                <button class="btn-save-notes" t-on-click="loadPvTemplate" title="Load PV template">
                  <i class="fa fa-file-text"/>
                  <span>Charger Modèle</span>
                </button>
                <!-- Save Button -->
                <button class="btn-save-notes" t-on-click="savePv">
                  <i class="fa fa-save"/>
                  Save
                </button>
              </div>
            </div>
            <div class="notes-editor">
              <textarea
                class="notes-textarea pv-textarea"
                placeholder="Rédigez votre procès-verbal ici...&#10;&#10;Utilisez 'Charger Modèle' pour un modèle pré-rempli ou 'PV Vierge' pour commencer de zéro."
                t-model="state.pv"
              />
            </div>
            <!-- Character/Word Count -->
            <div class="pv-footer">
              <div class="pv-stats">
                <span class="stat-item">
                  <i class="fa fa-font"/>
                  <t t-esc="state.pv.length"/> caractères
                </span>
        <!--        <span class="stat-item">-->
        <!--          <i class="fa fa-file-word-o"/>-->
        <!--          <t t-esc="state.pv.trim().split(/\s+/).filter(w => w.length > 0).length"/> mots-->
        <!--        </span>-->
              </div>
              <div class="pv-help">
                <i class="fa fa-info-circle"/>
                <span>Le PV est automatiquement sauvegardé avec la réunion</span>
              </div>
            </div>
          </div>
        </div>
</main>

        <!-- Right Sidebar: Agenda -->
<!--        <aside class="meeting-right-sidebar">-->
<!--          <div class="sidebar-card">-->
<!--            <div class="card-header">-->
<!--              <h3>-->
<!--                <i class="fa fa-list"/>-->
<!--                Agenda-->
<!--              </h3>-->
<!--            </div>-->
<!--            <div class="card-body">-->
<!--              <div class="participants-list">-->
<!--                <t t-if="state.session.subject_order?.length">-->
<!--                  <t t-foreach="state.session.subject_order" t-as="p" t-key="p_index">-->
<!--                    <div class="participant-item">-->
<!--                      <div class="participant-info">-->
<!--                        <div class="participant-name">-->
<!--                          <t t-esc="p.name"/>-->
<!--                        </div>-->
<!--                      </div>-->
<!--                    </div>-->
<!--                  </t>-->
<!--                </t>-->
<!--                <t t-else="">-->
<!--                  <div class="empty-participants">-->
<!--                    <i class="fa fa-users"/>-->
<!--                    <p>No Agenda</p>-->
<!--                  </div>-->
<!--                </t>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--        </aside>-->
      </div>
    </div>
  </t>
</templates>



        <!-- Main: Video Conference -->
<!--        <main class="meeting-main">-->
<!--          <div class="video-conference-container" t-if="state.session.display_camera">-->
<!--            <div id="jitsi-meet-container" class="jitsi-container"/>-->

<!--            &lt;!&ndash; Loading &ndash;&gt;-->
<!--            <div class="video-loading" t-if="state.loading &amp;&amp; !state.error">-->
<!--              <div class="loading-spinner">-->
<!--                <div class="spinner-ring"/>-->
<!--              </div>-->
<!--              <p>Loading meeting session...</p>-->
<!--            </div>-->

<!--            &lt;!&ndash; Error &ndash;&gt;-->
<!--            <div class="video-error" t-if="state.error">-->
<!--              <div class="error-icon">-->
<!--                <i class="fa fa-exclamation-triangle"/>-->
<!--              </div>-->
<!--              <h3>Connection Error</h3>-->
<!--              <p t-esc="state.error"/>-->
<!--              <div class="error-actions">-->
<!--                <button class="btn-retry" t-on-click="retryConnection">-->
<!--                  <i class="fa fa-refresh"/>-->
<!--                  Retry-->
<!--                </button>-->
<!--                <button class="btn-secondary" t-on-click="goBack">-->
<!--                  <i class="fa fa-arrow-left"/>-->
<!--                  Back-->
<!--                </button>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; Timer &ndash;&gt;-->
<!--            <div class="meeting-timer" t-if="state.jitsiLoaded">-->
<!--              <i class="fa fa-circle recording-indicator"/>-->
<!--              <span t-esc="state.meetingDuration"/>-->
<!--            </div>-->
<!--          </div>-->

<!--          &lt;!&ndash; Actions Section &ndash;&gt;-->
<!--          <div class="meeting-actions-section" t-if="state.showActions || !state.session.display_camera">-->
<!--            <div class="actions-header">-->
<!--              <h3>-->
<!--                <i class="fa fa-tasks"/>-->
<!--                My Action Items (<t t-esc="state.actions.length"/>)-->
<!--              </h3>-->
<!--              <div class="actions-header-actions">-->
<!--                <button class="btn-add-action" t-on-click="addNewAction">-->
<!--                  <i class="fa fa-plus"/>-->
<!--                  Add Action-->
<!--                </button>-->
<!--                <button class="btn-close-actions" t-on-click="toggleActions" t-if="state.session.display_camera">-->
<!--                  <i class="fa fa-times"/>-->
<!--                </button>-->
<!--              </div>-->
<!--            </div>-->
<!--            <div class="actions-body">-->
<!--              <div class="actions-list">-->
<!--                <t t-if="state.actions.length">-->
<!--                  <t t-foreach="state.actions" t-as="action" t-key="action.id || action_index">-->
<!--                    <div class="action-item" t-att-data-status="action.status">-->
<!--                      <div class="action-item-header">-->
<!--                        <input-->
<!--                          type="text"-->
<!--                          class="action-title-input"-->
<!--                          t-model="action.name"-->
<!--                          placeholder="Action title..."-->
<!--                          t-on-change="() => updateAction(action)"/>-->
<!--                        <button class="btn-delete-action" t-on-click="() => deleteAction(action)">-->
<!--                          <i class="fa fa-trash"/>-->
<!--                        </button>-->
<!--                      </div>-->
<!--                      <div class="action-item-body">-->
<!--                        <div class="action-fields-grid">-->
<!--                          <div class="action-field">-->
<!--                            <label><i class="fa fa-user"/> Assigned to:</label>-->
<!--                            <select t-model="action.assignee_id" t-on-change="() => updateAction(action)">-->
<!--                              <option value="">Select assignee...</option>-->
<!--                              <t t-foreach="state.availableAssignees" t-as="assignee" t-key="assignee.id">-->
<!--                                <option t-att-value="assignee.id">-->
<!--                                  <t t-esc="assignee.name"/>-->
<!--                                </option>-->
<!--                              </t>-->
<!--                            </select>-->
<!--                          </div>-->
<!--                          <div class="action-field">-->
<!--                            <label><i class="fa fa-calendar"/> Due Date:</label>-->
<!--                            <input-->
<!--                              type="date"-->
<!--                              t-model="action.dead_line"-->
<!--                              t-on-change="() => updateAction(action)"/>-->
<!--                          </div>-->
<!--                          <div class="action-field">-->
<!--                            <label><i class="fa fa-flag"/> Priority:</label>-->
<!--                            <select t-model="action.priority" t-on-change="() => updateAction(action)">-->
<!--                              <option value="low">Low</option>-->
<!--                              <option value="medium">Medium</option>-->
<!--                              <option value="high">High</option>-->
<!--                            </select>-->
<!--                          </div>-->
<!--                          <div class="action-field">-->
<!--                            <label><i class="fa fa-tasks"/> Status:</label>-->
<!--                            <select t-model="action.status" t-on-change="() => updateAction(action)">-->
<!--                              <option value="todo">To Do</option>-->
<!--                              <option value="in_progress">In Progress</option>-->
<!--                              <option value="done">Done</option>-->
<!--                            </select>-->
<!--                          </div>-->
<!--                        </div>-->
<!--                      </div>-->
<!--                    </div>-->
<!--                  </t>-->
<!--                </t>-->
<!--                <t t-else="">-->
<!--                  <div class="empty-actions">-->
<!--                    <i class="fa fa-tasks"/>-->
<!--                    <p>No action items yet</p>-->
<!--                    <button class="btn btn-primary btn-sm" t-on-click="addNewAction">-->
<!--                      <i class="fa fa-plus"/>-->
<!--                      Add First Action-->
<!--                    </button>-->
<!--                  </div>-->
<!--                </t>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->

<!--          &lt;!&ndash; Notes Section &ndash;&gt;-->
<!--          <div class="meeting-notes-section" t-if="state.showNotes || !state.session.display_camera">-->
<!--            <div class="notes-header">-->
<!--              <h3>-->
<!--                <i class="fa fa-file-text-o"/>-->
<!--                My Notes-->
<!--              </h3>-->
<!--              <div class="notes-actions">-->
<!--                <button class="btn-save-notes" t-on-click="saveNotes">-->
<!--                  <i class="fa fa-save"/>-->
<!--                  Save-->
<!--                </button>-->
<!--                <button class="btn-close-notes" t-on-click="toggleNotes">-->
<!--                  <i class="fa fa-times"/>-->
<!--                </button>-->
<!--              </div>-->
<!--            </div>-->
<!--            <div class="notes-editor">-->
<!--              <textarea-->
<!--                class="notes-textarea"-->
<!--                placeholder="Type your personal notes here..."-->
<!--                t-model="state.notes"/>-->
<!--            </div>-->
<!--          </div>-->
<!--        </main>-->